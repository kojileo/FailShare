# FailShare è‡ªå‹•ãƒ†ã‚¹ãƒˆæˆ¦ç•¥

## æ¦‚è¦

FailShareãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®å“è³ªä¿è¨¼ã¨ç¶™ç¶šçš„ãƒ‡ãƒªãƒãƒªãƒ¼ã‚’æ”¯æ´ã™ã‚‹ãŸã‚ã®åŒ…æ‹¬çš„ãªè‡ªå‹•ãƒ†ã‚¹ãƒˆæˆ¦ç•¥ã‚’å®šç¾©ã—ã¾ã™ã€‚

## ç¾åœ¨ã®çŠ¶æ³

### ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆçŠ¶æ³
- **Phase 1**: å®Œäº† (MVPå®Œæˆ)
- **æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯**: React Native + Expo, TypeScript, Firebase
- **ãƒ†ã‚¹ãƒˆç¾çŠ¶**: æ‰‹å‹•ãƒ†ã‚¹ãƒˆã®ã¿
- **å“è³ªèª²é¡Œ**: ãƒªã‚°ãƒ¬ãƒƒã‚·ãƒ§ãƒ³ãƒã‚°ã®ãƒªã‚¹ã‚¯

### ãƒ†ã‚¹ãƒˆè¦ä»¶
- **æ©Ÿèƒ½å“è³ª**: æ–°æ©Ÿèƒ½ã®å‹•ä½œä¿è¨¼
- **ãƒªã‚°ãƒ¬ãƒƒã‚·ãƒ§ãƒ³é˜²æ­¢**: æ—¢å­˜æ©Ÿèƒ½ã®å“è³ªç¶­æŒ
- **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**: ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®æ€§èƒ½ä¿è¨¼
- **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**: èªè¨¼ãƒ»èªå¯ã®å‹•ä½œç¢ºèª

## ãƒ†ã‚¹ãƒˆæˆ¦ç•¥å…¨ä½“åƒ

### ãƒ†ã‚¹ãƒˆãƒ”ãƒ©ãƒŸãƒƒãƒ‰

```
        ğŸ”º E2E Tests (10%)
       â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      ğŸ”º Integration Tests (20%)
     â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    ğŸ”º Unit Tests (70%)
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
```

### ãƒ†ã‚¹ãƒˆãƒ¬ãƒ™ãƒ«åˆ¥æ¦‚è¦

#### 1. Unit Tests (70%)
- **å¯¾è±¡**: å€‹åˆ¥é–¢æ•°ãƒ»ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
- **ç›®çš„**: ãƒ­ã‚¸ãƒƒã‚¯ã®æ­£ç¢ºæ€§ç¢ºèª
- **å®Ÿè¡Œé »åº¦**: æ¯å›ã®ã‚³ãƒŸãƒƒãƒˆ
- **å®Ÿè¡Œé€Ÿåº¦**: é«˜é€Ÿï¼ˆç§’å˜ä½ï¼‰

#### 2. Integration Tests (20%)
- **å¯¾è±¡**: ã‚µãƒ¼ãƒ“ã‚¹é–“é€£æºãƒ»APIçµ±åˆ
- **ç›®çš„**: ã‚·ã‚¹ãƒ†ãƒ é€£æºã®å‹•ä½œç¢ºèª
- **å®Ÿè¡Œé »åº¦**: Pull Request
- **å®Ÿè¡Œé€Ÿåº¦**: ä¸­é€Ÿï¼ˆåˆ†å˜ä½ï¼‰

#### 3. E2E Tests (10%)
- **å¯¾è±¡**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚·ãƒŠãƒªã‚ªå…¨ä½“
- **ç›®çš„**: å®Ÿéš›ã®ä½¿ç”¨ä½“é¨“ç¢ºèª
- **å®Ÿè¡Œé »åº¦**: ãƒªãƒªãƒ¼ã‚¹å‰
- **å®Ÿè¡Œé€Ÿåº¦**: ä½é€Ÿï¼ˆæ™‚é–“å˜ä½ï¼‰

## ãƒ†ã‚¹ãƒˆãƒ„ãƒ¼ãƒ«é¸å®š

### 1. Unit Testing

#### Jest
- **æ¡ç”¨ç†ç”±**: React Nativeæ¨™æº–ã€TypeScriptå¯¾å¿œ
- **å¯¾è±¡**: ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°ã€ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯
- **è¨­å®š**: `jest.config.js`

```javascript
module.exports = {
  preset: 'react-native',
  setupFilesAfterEnv: ['<rootDir>/jest.setup.js'],
  testPathIgnorePatterns: ['/node_modules/', '/e2e/'],
  transformIgnorePatterns: [
    'node_modules/(?!(react-native|@react-native|@expo|expo))',
  ],
  collectCoverageFrom: [
    'src/**/*.{ts,tsx}',
    '!src/**/*.d.ts',
    '!src/navigation/**',
  ],
  coverageThreshold: {
    global: {
      branches: 80,
      functions: 80,
      lines: 80,
      statements: 80,
    },
  },
};
```

#### React Native Testing Library
- **æ¡ç”¨ç†ç”±**: ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ†ã‚¹ãƒˆã«ç‰¹åŒ–
- **å¯¾è±¡**: React Nativeã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
- **ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸­å¿ƒã®ãƒ†ã‚¹ãƒˆ

```javascript
import { render, fireEvent } from '@testing-library/react-native';
import { HomeScreen } from '../screens/HomeScreen';

describe('HomeScreen', () => {
  it('should display search bar', () => {
    const { getByPlaceholderText } = render(<HomeScreen />);
    expect(getByPlaceholderText('å¤±æ•—è«‡ã‚’æ¤œç´¢...')).toBeTruthy();
  });
});
```

### 2. Integration Testing

#### Firebase Emulator Suite
- **æ¡ç”¨ç†ç”±**: å®Ÿéš›ã®Firebaseç’°å¢ƒã®å†ç¾
- **å¯¾è±¡**: Firebaseé€£æºæ©Ÿèƒ½
- **è¨­å®š**: `firebase.json`

```json
{
  "emulators": {
    "auth": {
      "port": 9099
    },
    "firestore": {
      "port": 8080
    },
    "ui": {
      "enabled": true,
      "port": 4000
    }
  }
}
```

#### MSW (Mock Service Worker)
- **æ¡ç”¨ç†ç”±**: APIå‘¼ã³å‡ºã—ã®ãƒ¢ãƒƒã‚¯
- **å¯¾è±¡**: å¤–éƒ¨APIé€£æº
- **ä½¿ç”¨å ´é¢**: ã‚µãƒ¼ãƒ“ã‚¹çµ±åˆãƒ†ã‚¹ãƒˆ

### 3. E2E Testing

#### Detox
- **æ¡ç”¨ç†ç”±**: React Nativeå°‚ç”¨E2Eãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯
- **å¯¾è±¡**: ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å…¨ä½“
- **è¨­å®š**: `.detoxrc.js`

```javascript
module.exports = {
  testRunner: 'jest',
  runnerConfig: 'e2e/config.json',
  configurations: {
    'ios.sim.debug': {
      device: 'simulator',
      app: 'ios.debug',
    },
    'android.emu.debug': {
      device: 'emulator',
      app: 'android.debug',
    },
  },
};
```

#### Maestro (ä»£æ›¿æ¡ˆ)
- **æ¡ç”¨ç†ç”±**: è¨­å®šã®ç°¡æ˜“ã•
- **å¯¾è±¡**: ã‚¯ãƒ­ã‚¹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ E2E
- **ç‰¹å¾´**: YAMLè¨­å®šã€ç›´æ„Ÿçš„ãªè¨˜è¿°

## ãƒ†ã‚¹ãƒˆå®Ÿè£…è¨ˆç”»

### Phase 1: Foundation (1ãƒ¶æœˆ)

#### 1. åŸºæœ¬ç’°å¢ƒæ§‹ç¯‰
```bash
# ãƒ†ã‚¹ãƒˆãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
npm install --save-dev jest @testing-library/react-native @testing-library/jest-native

# å‹å®šç¾©ã®è¿½åŠ 
npm install --save-dev @types/jest

# ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ„ãƒ¼ãƒ«
npm install --save-dev babel-plugin-istanbul
```

#### 2. åŸºæœ¬è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«

**jest.setup.js**
```javascript
import '@testing-library/jest-native/extend-expect';
import 'react-native-gesture-handler/jestSetup';

// Firebase Mock
jest.mock('@react-native-firebase/app', () => ({
  utils: () => ({
    FilePath: {
      MAIN_BUNDLE: 'MAIN_BUNDLE',
    },
  }),
}));

// AsyncStorage Mock
jest.mock('@react-native-async-storage/async-storage', () =>
  require('@react-native-async-storage/async-storage/jest/async-storage-mock')
);
```

#### 3. å„ªå…ˆãƒ†ã‚¹ãƒˆå¯¾è±¡
- **authService**: èªè¨¼ãƒ­ã‚¸ãƒƒã‚¯
- **storyService**: å¤±æ•—è«‡CRUDæ“ä½œ
- **Utility Functions**: å…±é€šãƒ­ã‚¸ãƒƒã‚¯

### Phase 2: Component Testing (2ãƒ¶æœˆ)

#### 1. ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ†ã‚¹ãƒˆ

**HomeScreen.test.tsx**
```typescript
import React from 'react';
import { render, fireEvent, waitFor } from '@testing-library/react-native';
import { HomeScreen } from '../screens/HomeScreen';
import { storyService } from '../services/storyService';

// Mock services
jest.mock('../services/storyService');
const mockStoryService = storyService as jest.Mocked<typeof storyService>;

describe('HomeScreen', () => {
  beforeEach(() => {
    mockStoryService.getStories.mockResolvedValue({
      stories: mockStories,
      lastVisible: null,
    });
  });

  it('should load stories on mount', async () => {
    const { getByText } = render(<HomeScreen />);
    
    await waitFor(() => {
      expect(getByText('ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã§å¤§å¤±æ•—')).toBeTruthy();
    });
  });

  it('should perform search when search bar is submitted', async () => {
    const { getByPlaceholderText } = render(<HomeScreen />);
    const searchBar = getByPlaceholderText('å¤±æ•—è«‡ã‚’æ¤œç´¢...');
    
    fireEvent.changeText(searchBar, 'ä»•äº‹');
    fireEvent(searchBar, 'submitEditing');
    
    await waitFor(() => {
      expect(mockStoryService.getStories).toHaveBeenCalledWith({
        searchText: 'ä»•äº‹',
      });
    });
  });
});
```

#### 2. Serviceå±¤ãƒ†ã‚¹ãƒˆ

**storyService.test.ts**
```typescript
import { storyService } from '../services/storyService';
import { firebase } from '../services/firebase';

// Firebase Mock
jest.mock('../services/firebase');

describe('storyService', () => {
  describe('createStory', () => {
    it('should create story successfully', async () => {
      const mockStoryData = {
        title: 'ãƒ†ã‚¹ãƒˆå¤±æ•—è«‡',
        category: 'ä»•äº‹' as const,
        situation: 'ãƒ†ã‚¹ãƒˆçŠ¶æ³',
        action: 'ãƒ†ã‚¹ãƒˆè¡Œå‹•',
        result: 'ãƒ†ã‚¹ãƒˆçµæœ',
        learning: 'ãƒ†ã‚¹ãƒˆå­¦ã³',
        emotion: 'å¾Œæ‚”' as const,
      };

      const storyId = await storyService.createStory('user123', mockStoryData);
      
      expect(storyId).toBeDefined();
      expect(typeof storyId).toBe('string');
    });

    it('should throw error for invalid data', async () => {
      const invalidData = {
        title: '', // ç©ºã®ã‚¿ã‚¤ãƒˆãƒ«
        category: 'ä»•äº‹' as const,
        // ä»–ã®å¿…é ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãªã—
      };

      await expect(
        storyService.createStory('user123', invalidData)
      ).rejects.toThrow('æŠ•ç¨¿ã«å¤±æ•—ã—ã¾ã—ãŸ');
    });
  });

  describe('getStories', () => {
    it('should filter stories by category', async () => {
      const result = await storyService.getStories({ category: 'ä»•äº‹' });
      
      expect(result.stories).toBeDefined();
      expect(Array.isArray(result.stories)).toBe(true);
    });

    it('should filter stories by search text', async () => {
      const result = await storyService.getStories({ searchText: 'ãƒ—ãƒ¬ã‚¼ãƒ³' });
      
      expect(result.stories).toBeDefined();
      result.stories.forEach(story => {
        expect(
          story.content.title.includes('ãƒ—ãƒ¬ã‚¼ãƒ³') ||
          story.content.situation.includes('ãƒ—ãƒ¬ã‚¼ãƒ³')
        ).toBe(true);
      });
    });
  });
});
```

### Phase 3: Integration Testing (3ãƒ¶æœˆ)

#### 1. Firebase Integration

**firebase.integration.test.ts**
```typescript
import { authService } from '../services/authService';
import { storyService } from '../services/storyService';

describe('Firebase Integration', () => {
  beforeAll(async () => {
    // Firebase Emulatorèµ·å‹•
    await firebase.initializeTestApp({
      projectId: 'failshare-test',
    });
  });

  afterAll(async () => {
    // ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
    await firebase.clearFirestoreData({ projectId: 'failshare-test' });
  });

  describe('Auth + Story Flow', () => {
    it('should allow authenticated user to create story', async () => {
      // 1. åŒ¿åãƒ­ã‚°ã‚¤ãƒ³
      const user = await authService.signInAnonymous();
      expect(user).toBeDefined();

      // 2. å¤±æ•—è«‡ä½œæˆ
      const storyData = {
        title: 'çµ±åˆãƒ†ã‚¹ãƒˆå¤±æ•—è«‡',
        category: 'ä»•äº‹' as const,
        situation: 'ãƒ†ã‚¹ãƒˆçŠ¶æ³',
        action: 'ãƒ†ã‚¹ãƒˆè¡Œå‹•',
        result: 'ãƒ†ã‚¹ãƒˆçµæœ',
        learning: 'ãƒ†ã‚¹ãƒˆå­¦ã³',
        emotion: 'å¾Œæ‚”' as const,
      };

      const storyId = await storyService.createStory(user.id, storyData);
      expect(storyId).toBeDefined();

      // 3. ä½œæˆã•ã‚ŒãŸå¤±æ•—è«‡ã®å–å¾—
      const story = await storyService.getStoryById(storyId);
      expect(story).toBeDefined();
      expect(story.content.title).toBe('çµ±åˆãƒ†ã‚¹ãƒˆå¤±æ•—è«‡');
    });
  });
});
```

#### 2. API Integration

**api.integration.test.ts**
```typescript
import { render, waitFor } from '@testing-library/react-native';
import { HomeScreen } from '../screens/HomeScreen';

describe('API Integration', () => {
  it('should display real data from Firebase', async () => {
    const { getByText } = render(<HomeScreen />);
    
    // å®Ÿéš›ã®Firebaseã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
    await waitFor(() => {
      expect(getByText(/å¤±æ•—è«‡/)).toBeTruthy();
    }, { timeout: 5000 });
  });
});
```

### Phase 4: E2E Testing (4ãƒ¶æœˆ)

#### 1. Detox E2E Tests

**e2e/auth.e2e.js**
```javascript
describe('Authentication Flow', () => {
  beforeEach(async () => {
    await device.reloadReactNative();
  });

  it('should sign in anonymously', async () => {
    await expect(element(by.text('åŒ¿åã§ã‚µã‚¤ãƒ³ã‚¤ãƒ³'))).toBeVisible();
    await element(by.text('åŒ¿åã§ã‚µã‚¤ãƒ³ã‚¤ãƒ³')).tap();
    
    await waitFor(element(by.text('ãƒ›ãƒ¼ãƒ ')))
      .toBeVisible()
      .withTimeout(3000);
  });
});
```

**e2e/story.e2e.js**
```javascript
describe('Story Management', () => {
  beforeEach(async () => {
    await device.reloadReactNative();
    // äº‹å‰ã«ãƒ­ã‚°ã‚¤ãƒ³
    await element(by.text('åŒ¿åã§ã‚µã‚¤ãƒ³ã‚¤ãƒ³')).tap();
    await waitFor(element(by.text('ãƒ›ãƒ¼ãƒ '))).toBeVisible();
  });

  it('should create a new story', async () => {
    // FABãƒœã‚¿ãƒ³ã‚’ã‚¿ãƒƒãƒ—
    await element(by.id('fab-create-story')).tap();
    
    // ãƒ•ã‚©ãƒ¼ãƒ å…¥åŠ›
    await element(by.id('story-title-input')).typeText('E2Eãƒ†ã‚¹ãƒˆå¤±æ•—è«‡');
    await element(by.id('category-ä»•äº‹')).tap();
    await element(by.id('situation-input')).typeText('ãƒ†ã‚¹ãƒˆçŠ¶æ³');
    await element(by.id('action-input')).typeText('ãƒ†ã‚¹ãƒˆè¡Œå‹•');
    await element(by.id('result-input')).typeText('ãƒ†ã‚¹ãƒˆçµæœ');
    await element(by.id('learning-input')).typeText('ãƒ†ã‚¹ãƒˆå­¦ã³');
    await element(by.id('emotion-å¾Œæ‚”')).tap();
    
    // æŠ•ç¨¿ãƒœã‚¿ãƒ³ã‚’ã‚¿ãƒƒãƒ—
    await element(by.text('æŠ•ç¨¿ã™ã‚‹')).tap();
    
    // æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç¢ºèª
    await waitFor(element(by.text('æŠ•ç¨¿ãŒå®Œäº†ã—ã¾ã—ãŸ')))
      .toBeVisible()
      .withTimeout(5000);
  });

  it('should search stories', async () => {
    await element(by.id('search-bar')).typeText('ä»•äº‹');
    await element(by.id('search-bar')).tapReturnKey();
    
    await waitFor(element(by.text('æ¤œç´¢çµæœ')))
      .toBeVisible()
      .withTimeout(3000);
  });
});
```

#### 2. Maestro E2E Tests

**e2e/flows/auth.yaml**
```yaml
appId: com.failshare.app
---
- launchApp
- tapOn: "åŒ¿åã§ã‚µã‚¤ãƒ³ã‚¤ãƒ³"
- assertVisible: "ãƒ›ãƒ¼ãƒ "
- assertVisible: "å¤±æ•—è«‡ã‚’æ¤œç´¢..."
```

**e2e/flows/create-story.yaml**
```yaml
appId: com.failshare.app
---
- launchApp
- tapOn: "åŒ¿åã§ã‚µã‚¤ãƒ³ã‚¤ãƒ³"
- assertVisible: "ãƒ›ãƒ¼ãƒ "
- tapOn: 
    id: "fab-create-story"
- inputText: "E2Eãƒ†ã‚¹ãƒˆå¤±æ•—è«‡"
- tapOn: "ä»•äº‹"
- inputText: "ãƒ†ã‚¹ãƒˆçŠ¶æ³"
- tapOn: "æŠ•ç¨¿ã™ã‚‹"
- assertVisible: "æŠ•ç¨¿ãŒå®Œäº†ã—ã¾ã—ãŸ"
```

## ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæˆ¦ç•¥

### 1. ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç’°å¢ƒ

#### é–‹ç™ºä¸­ã®ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
```bash
# ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆï¼ˆWatch Modeï¼‰
npm run test:watch

# ã‚«ãƒãƒ¬ãƒƒã‚¸ä»˜ããƒ†ã‚¹ãƒˆ
npm run test:coverage

# çµ±åˆãƒ†ã‚¹ãƒˆ
npm run test:integration

# E2Eãƒ†ã‚¹ãƒˆ
npm run test:e2e
```

#### package.jsonè¨­å®š
```json
{
  "scripts": {
    "test": "jest",
    "test:watch": "jest --watch",
    "test:coverage": "jest --coverage",
    "test:integration": "jest --testPathPattern=integration",
    "test:e2e": "detox test",
    "test:ci": "jest --ci --coverage --watchAll=false"
  }
}
```

### 2. CI/CDç’°å¢ƒ

#### GitHub Actionsè¨­å®š

**.github/workflows/test.yml**
```yaml
name: Test

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main, develop]

jobs:
  unit-test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: '18'
          cache: 'npm'
      
      - name: Install dependencies
        run: npm ci
      
      - name: Run unit tests
        run: npm run test:ci
      
      - name: Upload coverage
        uses: codecov/codecov-action@v3

  integration-test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: '18'
          cache: 'npm'
      
      - name: Install dependencies
        run: npm ci
      
      - name: Start Firebase Emulator
        run: |
          npm install -g firebase-tools
          firebase emulators:start --detach
      
      - name: Run integration tests
        run: npm run test:integration
      
      - name: Stop Firebase Emulator
        run: firebase emulators:stop

  e2e-test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: '18'
          cache: 'npm'
      
      - name: Install dependencies
        run: npm ci
      
      - name: Build app
        run: npm run build
      
      - name: Run E2E tests
        run: npm run test:e2e
```

### 3. å“è³ªã‚²ãƒ¼ãƒˆ

#### ã‚«ãƒãƒ¬ãƒƒã‚¸è¦ä»¶
- **ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ**: 80%ä»¥ä¸Š
- **ã‚µãƒ¼ãƒ“ã‚¹å±¤**: 90%ä»¥ä¸Š
- **é‡è¦ãªæ©Ÿèƒ½**: 100%

#### ãƒ†ã‚¹ãƒˆå¿…é ˆæ¡ä»¶
- **Pull Request**: ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆå¿…é ˆ
- **develop â†’ main**: çµ±åˆãƒ†ã‚¹ãƒˆå¿…é ˆ
- **ãƒªãƒªãƒ¼ã‚¹**: E2Eãƒ†ã‚¹ãƒˆå¿…é ˆ

## ãƒ¢ãƒƒã‚¯æˆ¦ç•¥

### 1. Firebase Mock

**__mocks__/firebase.ts**
```typescript
export const mockFirestore = {
  collection: jest.fn(() => ({
    add: jest.fn(),
    doc: jest.fn(() => ({
      get: jest.fn(),
      set: jest.fn(),
      update: jest.fn(),
      delete: jest.fn(),
    })),
    where: jest.fn(() => ({
      get: jest.fn(),
    })),
  })),
};

export const mockAuth = {
  signInAnonymously: jest.fn(),
  signOut: jest.fn(),
  onAuthStateChanged: jest.fn(),
};
```

### 2. AsyncStorage Mock

**__mocks__/asyncStorage.ts**
```typescript
export default {
  getItem: jest.fn(),
  setItem: jest.fn(),
  removeItem: jest.fn(),
  clear: jest.fn(),
};
```

### 3. Navigation Mock

**__mocks__/navigation.ts**
```typescript
export const mockNavigation = {
  navigate: jest.fn(),
  goBack: jest.fn(),
  reset: jest.fn(),
};

export const mockRoute = {
  params: {},
};
```

## ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ç®¡ç†

### 1. ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ä½œæˆ

**__tests__/fixtures/stories.ts**
```typescript
import { FailureStory } from '../../src/types';

export const mockStories: FailureStory[] = [
  {
    id: 'story1',
    authorId: 'user1',
    content: {
      title: 'ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã§å¤§å¤±æ•—',
      category: 'ä»•äº‹',
      situation: 'ãƒ†ã‚¹ãƒˆçŠ¶æ³',
      action: 'ãƒ†ã‚¹ãƒˆè¡Œå‹•',
      result: 'ãƒ†ã‚¹ãƒˆçµæœ',
      learning: 'ãƒ†ã‚¹ãƒˆå­¦ã³',
      emotion: 'å¾Œæ‚”',
    },
    metadata: {
      createdAt: new Date('2024-01-01'),
      viewCount: 10,
      helpfulCount: 5,
      commentCount: 2,
      tags: ['ãƒ—ãƒ¬ã‚¼ãƒ³', 'ä»•äº‹'],
    },
  },
];
```

### 2. ãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ¼é–¢æ•°

**__tests__/factories/storyFactory.ts**
```typescript
import { CreateStoryData } from '../../src/services/storyService';

export const createStoryData = (
  overrides: Partial<CreateStoryData> = {}
): CreateStoryData => ({
  title: 'ãƒ†ã‚¹ãƒˆå¤±æ•—è«‡',
  category: 'ä»•äº‹',
  situation: 'ãƒ†ã‚¹ãƒˆçŠ¶æ³',
  action: 'ãƒ†ã‚¹ãƒˆè¡Œå‹•',
  result: 'ãƒ†ã‚¹ãƒˆçµæœ',
  learning: 'ãƒ†ã‚¹ãƒˆå­¦ã³',
  emotion: 'å¾Œæ‚”',
  ...overrides,
});
```

## ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ

### 1. ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°æ€§èƒ½

**performance.test.tsx**
```typescript
import { render } from '@testing-library/react-native';
import { HomeScreen } from '../screens/HomeScreen';

describe('Performance Tests', () => {
  it('should render large story list within acceptable time', async () => {
    const start = Date.now();
    
    const { getByText } = render(
      <HomeScreen stories={largeMockStories} />
    );
    
    const end = Date.now();
    const renderTime = end - start;
    
    expect(renderTime).toBeLessThan(1000); // 1ç§’ä»¥å†…
  });
});
```

### 2. ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡

**memory.test.ts**
```typescript
describe('Memory Usage', () => {
  it('should not cause memory leaks', () => {
    const initialMemory = process.memoryUsage().heapUsed;
    
    // å¤§é‡ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½œæˆãƒ»ç ´æ£„
    for (let i = 0; i < 1000; i++) {
      const { unmount } = render(<HomeScreen />);
      unmount();
    }
    
    global.gc(); // ã‚¬ãƒ™ãƒ¼ã‚¸ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
    
    const finalMemory = process.memoryUsage().heapUsed;
    const memoryIncrease = finalMemory - initialMemory;
    
    expect(memoryIncrease).toBeLessThan(50 * 1024 * 1024); // 50MBä»¥å†…
  });
});
```

## ãƒ†ã‚¹ãƒˆãƒ¬ãƒãƒ¼ãƒˆ

### 1. ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆ

**jest.config.js**
```javascript
module.exports = {
  collectCoverageFrom: [
    'src/**/*.{ts,tsx}',
    '!src/**/*.d.ts',
    '!src/**/index.ts',
  ],
  coverageReporters: ['html', 'text', 'lcov'],
  coverageDirectory: 'coverage',
  coverageThreshold: {
    global: {
      branches: 80,
      functions: 80,
      lines: 80,
      statements: 80,
    },
    './src/services/': {
      branches: 90,
      functions: 90,
      lines: 90,
      statements: 90,
    },
  },
};
```

### 2. è¦–è¦šçš„å›å¸°ãƒ†ã‚¹ãƒˆ

**visual.test.tsx**
```typescript
import { render } from '@testing-library/react-native';
import { HomeScreen } from '../screens/HomeScreen';

describe('Visual Regression Tests', () => {
  it('should match snapshot', () => {
    const { toJSON } = render(<HomeScreen />);
    expect(toJSON()).toMatchSnapshot();
  });
});
```

## ç¶™ç¶šçš„æ”¹å–„

### 1. ãƒ†ã‚¹ãƒˆãƒ¡ãƒˆãƒªã‚¯ã‚¹

- **å®Ÿè¡Œæ™‚é–“**: ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆã®å®Ÿè¡Œæ™‚é–“ç›£è¦–
- **æˆåŠŸç‡**: ãƒ†ã‚¹ãƒˆã®æˆåŠŸç‡è¿½è·¡
- **ã‚«ãƒãƒ¬ãƒƒã‚¸**: ã‚³ãƒ¼ãƒ‰ã‚«ãƒãƒ¬ãƒƒã‚¸ã®æ¨ç§»
- **ãƒ•ãƒ¬ãƒ¼ã‚¯iness**: ä¸å®‰å®šãªãƒ†ã‚¹ãƒˆã®ç‰¹å®š

### 2. å®šæœŸçš„ãªè¦‹ç›´ã—

#### æœˆæ¬¡ãƒ¬ãƒ“ãƒ¥ãƒ¼
- ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ™‚é–“ã®æœ€é©åŒ–
- ä¸è¦ãªãƒ†ã‚¹ãƒˆã®å‰Šé™¤
- ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã®æ›´æ–°

#### å››åŠæœŸãƒ¬ãƒ“ãƒ¥ãƒ¼
- ãƒ†ã‚¹ãƒˆæˆ¦ç•¥ã®è¦‹ç›´ã—
- æ–°ã—ã„ãƒ†ã‚¹ãƒˆãƒ„ãƒ¼ãƒ«ã®æ¤œè¨
- ãƒ†ã‚¹ãƒˆå“è³ªã®è©•ä¾¡

## å®Ÿè£…ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«

### Phase 1 (1ãƒ¶æœˆ)
- [ ] Jestç’°å¢ƒæ§‹ç¯‰
- [ ] åŸºæœ¬çš„ãªãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ
- [ ] CI/CDçµ±åˆ

### Phase 2 (2ãƒ¶æœˆ)
- [ ] React Native Testing Libraryå°å…¥
- [ ] ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ†ã‚¹ãƒˆ
- [ ] Firebase Mockè¨­å®š

### Phase 3 (3ãƒ¶æœˆ)
- [ ] Firebase Emulatorçµ±åˆ
- [ ] çµ±åˆãƒ†ã‚¹ãƒˆå®Ÿè£…
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ

### Phase 4 (4ãƒ¶æœˆ)
- [ ] Detox E2Eç’°å¢ƒæ§‹ç¯‰
- [ ] ä¸»è¦ãƒ•ãƒ­ãƒ¼ã®E2Eãƒ†ã‚¹ãƒˆ
- [ ] è¦–è¦šçš„å›å¸°ãƒ†ã‚¹ãƒˆ

## æˆåŠŸæŒ‡æ¨™

### å“è³ªæŒ‡æ¨™
- **ãƒã‚°æ¤œå‡ºç‡**: 90%ä»¥ä¸Šã®ãƒã‚°ã‚’ãƒ†ã‚¹ãƒˆã§æ¤œå‡º
- **ã‚«ãƒãƒ¬ãƒƒã‚¸**: 80%ä»¥ä¸Šã®ã‚³ãƒ¼ãƒ‰ã‚«ãƒãƒ¬ãƒƒã‚¸
- **ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“**: ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆå®Ÿè¡Œæ™‚é–“ < 10åˆ†

### ãƒ—ãƒ­ã‚»ã‚¹æŒ‡æ¨™
- **ãƒ†ã‚¹ãƒˆå®Ÿè¡Œé »åº¦**: 100%ã®PRã§ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
- **è‡ªå‹•åŒ–ç‡**: 90%ä»¥ä¸Šã®ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹è‡ªå‹•åŒ–
- **ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹æ€§**: æ–°æ©Ÿèƒ½é–‹ç™ºæ™‚ã®ãƒ†ã‚¹ãƒˆä½œæˆæ™‚é–“ < é–‹ç™ºæ™‚é–“ã®30%

---

**ã“ã®è‡ªå‹•ãƒ†ã‚¹ãƒˆæˆ¦ç•¥ã«ã‚ˆã‚Šã€FailShareã®å“è³ªã‚’ç¶™ç¶šçš„ã«ä¿è¨¼ã—ã€å®‰å¿ƒã—ã¦ãƒªãƒªãƒ¼ã‚¹ã§ãã‚‹é–‹ç™ºç’°å¢ƒã‚’æ§‹ç¯‰ã—ã¾ã™ã€‚æ®µéšçš„ãªå®Ÿè£…ã«ã‚ˆã‚Šã€é–‹ç™ºé€Ÿåº¦ã‚’è½ã¨ã™ã“ã¨ãªãå“è³ªã‚’å‘ä¸Šã•ã›ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚** 